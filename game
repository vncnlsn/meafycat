let score = 0;
let missedCars = 0;
const maxMisses = 3;
let carSpeed = 1;
let spawnRate = 1000;
let catSpeed = 2;
let gameStarted = false;

// Meow sound
const meowSound = new Audio('https://www.fesliyanstudios.com/play-mp3/438');

// Make the game responsive
const screenWidth = window.innerWidth;
const screenHeight = window.innerHeight;

// Display score
const scoreDisplay = document.createElement('div');
scoreDisplay.style.position = 'fixed';
scoreDisplay.style.top = '10px';
scoreDisplay.style.left = '10px';
scoreDisplay.style.color = 'white';
scoreDisplay.style.fontSize = '24px';
document.body.appendChild(scoreDisplay);

const startMessage = document.createElement('div');
startMessage.textContent = 'Press 7 or SPACE to Start';
startMessage.style.position = 'fixed';
startMessage.style.top = '50%';
startMessage.style.left = '50%';
startMessage.style.transform = 'translate(-50%, -50%)';
startMessage.style.color = 'white';
startMessage.style.fontSize = '24px';
document.body.appendChild(startMessage);

// Update Score UI
function updateScore() {
    scoreDisplay.textContent = `Score: ${score} | Missed: ${missedCars}/${maxMisses}`;
}
updateScore();

// Cat Movement
const cat = document.createElement('img');
cat.src = 'https://i.pinimg.com/originals/71/14/df/7114df589c225dc402c182038d8d6dc8.gif';
cat.style.width = screenWidth > 600 ? '7%' : '15%'; // Adjust size for mobile
cat.style.position = 'absolute';
cat.style.top = '50%';
cat.style.left = '50%';
document.body.appendChild(cat);

let catX = 50, catY = 50;

window.addEventListener('keydown', (e) => {
    if (!gameStarted && (e.code === 'Digit7' || e.code === 'Space')) {
        startGame();
    }
    if (gameStarted) {
        if (e.code === 'ArrowUp') catY -= catSpeed;
        if (e.code === 'ArrowDown') catY += catSpeed;
        if (e.code === 'ArrowLeft') catX -= catSpeed;
        if (e.code === 'ArrowRight') catX += catSpeed;
        updateCatPosition();
    }
});

// Mobile Controls
window.addEventListener('touchstart', (e) => {
    if (!gameStarted) {
        startGame();
    } else {
        const touchX = e.touches[0].clientX;
        const touchY = e.touches[0].clientY;

        if (touchY < screenHeight / 3) catY -= catSpeed;
        else if (touchY > (2 * screenHeight) / 3) catY += catSpeed;
        else if (touchX < screenWidth / 2) catX -= catSpeed;
        else catX += catSpeed;
    }
    updateCatPosition();
});

function updateCatPosition() {
    cat.style.left = catX + '%';
    cat.style.top = catY + '%';
}

function startGame() {
    gameStarted = true;
    startMessage.style.display = 'none';
    setInterval(createCar, spawnRate);
    setInterval(() => {
        carSpeed += 0.2;
        spawnRate = Math.max(500, spawnRate - 100);
    }, 5000);
    setInterval(createPowerup, 10000);
}

// Car Generation and Animation
function createCar() {
    const car = document.createElement('img');
    car.src = 'https://www.freeiconspng.com/thumbs/top-car-view-png/yellow-top-car-png-7.png';
    car.style.width = screenWidth > 600 ? '10%' : '20%'; // Adjust size for mobile
    car.style.position = 'absolute';
    car.style.top = '-10%';
    car.style.left = `${Math.random() * 80 + 10}%`;
    document.body.appendChild(car);
    moveCar(car);
}

function moveCar(car) {
    let carY = -10;
    const carInterval = setInterval(() => {
        carY += carSpeed;
        car.style.top = carY + '%';

        // Check collision
        if (checkCollision(car, cat)) {
            score++;
            meowSound.play();
            updateScore();
            clearInterval(carInterval);
            car.remove();
        }
        // Check if missed
        else if (carY > 100) {
            missedCars++;
            updateScore();
            clearInterval(carInterval);
            car.remove();
            if (missedCars >= maxMisses) gameOver();
        }
    }, 50);
}

function checkCollision(car, cat) {
    const carRect = car.getBoundingClientRect();
    const catRect = cat.getBoundingClientRect();
    return (
        carRect.left < catRect.right &&
        carRect.right > catRect.left &&
        carRect.top < catRect.bottom &&
        carRect.bottom > catRect.top
    );
}

function gameOver() {
    alert(`Game Over! Final Score: ${score}`);
    location.reload();
}

// Powerups
function createPowerup() {
    const powerup = document.createElement('div');
    powerup.textContent = '⭐';
    powerup.style.position = 'absolute';
    powerup.style.top = `${Math.random() * 80 + 10}%`;
    powerup.style.left = `${Math.random() * 80 + 10}%`;
    powerup.style.fontSize = '30px';
    powerup.style.color = 'yellow';
    document.body.appendChild(powerup);

    setTimeout(() => powerup.remove(), 5000);

    powerup.addEventListener('click', () => {
        if (Math.random() > 0.5) {
            missedCars = Math.max(0, missedCars - 1);
        } else {
            catSpeed += 1;
        }
        updateScore();
        powerup.remove();
    });
}
